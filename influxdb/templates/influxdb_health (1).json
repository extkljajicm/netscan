[{"apiVersion":"influxdata.com/v2alpha1","kind":"Label","metadata":{"name":"cool-black-8c6001"},"spec":{"color":"#00a3ff","name":"health"}},{"apiVersion":"influxdata.com/v2alpha1","kind":"Dashboard","metadata":{"name":"adoring-mendeleev-0c6001"},"spec":{"associations":[{"kind":"Label","name":"cool-black-8c6001"}],"charts":[{"colors":[{"id":"0","name":"viridian","type":"min","hex":"#32B08C"},{"id":"5WshY6Qd70B_uAeiIxY8y","name":"rainforest","type":"threshold","hex":"#4ED8A0","value":150},{"id":"x3RB4SPZoIz-SvPRuBmMb","name":"honeydew","type":"threshold","hex":"#7CE490","value":300},{"id":"slPdbWGeuEHv7hYpZbhF6","name":"pineapple","type":"threshold","hex":"#FFB94A","value":450},{"id":"7TWrsCYVMZ5ZmIR5pekjX","name":"tiger","type":"threshold","hex":"#F48D38","value":600},{"id":"2OZn_6lzAreiIcQZKhItc","name":"thunder","type":"threshold","hex":"#FFD255","value":750},{"id":"ouE37oACM4LK2aZg_LMQi","name":"curacao","type":"threshold","hex":"#F95F53","value":900},{"id":"1","name":"fire","type":"max","hex":"#DC4E58","value":1000}],"decimalPlaces":0,"height":4,"kind":"Gauge","name":"ICMP pps sent","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"pings_sent_total\")\n  // Calculate the per-second rate of change\n  // nonNegative: true handles counter resets gracefully\n  |> derivative(unit: 1s, nonNegative: true)\n  // average that rate over your window period\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> yield(name: \"pings_per_second\")"}],"staticLegend":{},"suffix":" pps","tickSuffix":" pps","width":4},{"axes":[{"base":"10","name":"x","scale":"linear"},{"base":"10","name":"y","scale":"linear"}],"colorizeRows":true,"colors":[{"id":"n-sHjsdyiIfjKmmgegHDy","name":"Do Androids Dream of Electric Sheep?","type":"scale","hex":"#8F8AF4"},{"id":"NwCEMOLXhWFQJ3laFXgP_","name":"Do Androids Dream of Electric Sheep?","type":"scale","hex":"#A51414"},{"id":"i1lHxMpr3ccoTCmJy2gEc","name":"Do Androids Dream of Electric Sheep?","type":"scale","hex":"#F4CF31"}],"geom":"line","height":5,"heightRatio":0.2,"hoverDimension":"auto","kind":"Xy","legendColorizeRows":true,"legendOpacity":1,"legendOrientationThreshold":100000000,"name":"# Active Pingers and ICMP pps","opacity":1,"orientationThreshold":100000000,"position":"overlaid","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"active_pingers\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> yield(name: \"mean\")\n\n  from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"pings_sent_total\")\n  // Calculate the per-second rate of change\n  // nonNegative: true handles counter resets gracefully\n  |> derivative(unit: 1s, nonNegative: true)\n  // average that rate over your window period\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> set(key: \"_field\", value: \"pings_per_second\")\n  |> yield(name: \"pings_per_second\")"}],"show":true,"staticLegend":{"colorizeRows":true,"heightRatio":0.2,"show":true,"opacity":1,"orientationThreshold":100000000,"widthRatio":1},"width":6,"widthRatio":1,"xCol":"_time","yCol":"_value","yPos":4},{"colors":[{"id":"base","name":"viridian","type":"text","hex":"#32B08C"},{"id":"Yl4KUxbY24ync-TgWmmJw","name":"fire","type":"text","hex":"#DC4E58","value":1}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"Failed Batches","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"influxdb_failed_batches\")\n  |> aggregateWindow(every: v.windowPeriod, fn: last, createEmpty: false)\n  |> yield(name: \"last\")"}],"staticLegend":{},"width":1,"xPos":4},{"colors":[{"id":"base","name":"viridian","type":"text","hex":"#32B08C"},{"id":"sWvYZphNJsCK-VCbWxM4u","name":"pineapple","type":"text","hex":"#FFB94A","value":100},{"id":"3g0o6sa-3rzL_o4dIS_gS","name":"curacao","type":"text","hex":"#F95F53","value":200}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"Active Pingers","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"active_pingers\")\n  |> aggregateWindow(every: v.windowPeriod, fn: last, createEmpty: false)\n  |> yield(name: \"last\")"}],"staticLegend":{},"width":1,"xPos":4,"yPos":2},{"colors":[{"id":"base","name":"viridian","type":"text","hex":"#32B08C"},{"id":"Yl4KUxbY24ync-TgWmmJw","name":"fire","type":"text","hex":"#DC4E58","value":256}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"Go Heap Allocation [MByte]","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"memory_mb\")\n  |> mean()\n  |> yield(name: \"max\")"}],"staticLegend":{},"suffix":" MB","width":2,"xPos":5},{"colors":[{"id":"base","name":"laser","type":"text","hex":"#00C9FF"}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"Total ICMP Packets sent","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"pings_sent_total\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> yield(name: \"pings_per_second\")"}],"staticLegend":{},"width":2,"xPos":5,"yPos":2},{"axes":[{"base":"10","name":"x","scale":"linear"},{"base":"10","name":"y","scale":"linear"}],"colorizeRows":true,"colors":[{"id":"4RpYsUx2ofQxaQsAnf9yg","name":"Color Blind Friendly - Light","type":"scale","hex":"#FFFFFF"},{"id":"eino9vK6Pko4z3pxDVvIE","name":"Color Blind Friendly - Light","type":"scale","hex":"#E69F00"},{"id":"8XUB2eINL7LS-6PyeoJsU","name":"Color Blind Friendly - Light","type":"scale","hex":"#56B4E9"},{"id":"5cPhpHcvhS4CrpORqpj88","name":"Color Blind Friendly - Light","type":"scale","hex":"#009E73"},{"id":"CZgjamQDTFHj9jC3duPlS","name":"Color Blind Friendly - Light","type":"scale","hex":"#F0E442"},{"id":"Kn1D8Pc1uD2dIVI4s23L_","name":"Color Blind Friendly - Light","type":"scale","hex":"#0072B2"},{"id":"xmGKAneVLL8urn_ay4-YD","name":"Color Blind Friendly - Light","type":"scale","hex":"#D55E00"},{"id":"ImMFpkdf38Z4Pm7ToOzNt","name":"Color Blind Friendly - Light","type":"scale","hex":"#CC79A7"}],"geom":"line","height":5,"heightRatio":0.2,"hoverDimension":"auto","kind":"Xy","legendColorizeRows":true,"legendOpacity":1,"legendOrientationThreshold":100000000,"name":"# Go-Routines and Device Count","opacity":1,"orientationThreshold":100000000,"position":"overlaid","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"device_count\" or r[\"_field\"] == \"goroutines\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> yield(name: \"mean\")"}],"show":true,"staticLegend":{"colorizeRows":true,"heightRatio":0.2,"show":true,"opacity":1,"orientationThreshold":100000000,"widthRatio":1},"width":6,"widthRatio":1,"xCol":"_time","xPos":6,"yCol":"_value","yPos":4},{"colors":[{"id":"base","name":"laser","type":"text","hex":"#00C9FF"}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"OS-RSS [MByte]","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"rss_mb\")\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> yield(name: \"mean\")"}],"staticLegend":{},"suffix":" MB","width":2,"xPos":7},{"colors":[{"id":"base","name":"comet","type":"text","hex":"#9394FF"}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"Device Count","queries":[{"query":"from(bucket: \"netscan\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"ping\")\n  |> filter(fn: (r) => r[\"_field\"] == \"success\")\n  |> filter(fn: (r) => r[\"_value\"] == true)\n  |> group() // This is the fix: merges all data into one table\n  |> distinct(column: \"ip\") // Now finds all unique IPs from the single table\n  |> count() // Counts the total number of unique IPs"}],"staticLegend":{},"width":2,"xPos":7,"yPos":2},{"colors":[{"id":"base","name":"viridian","type":"text","hex":"#32B08C"}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"InfluxDB Status","queries":[{"query":"from(bucket: \"health\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"health_metrics\")\n  |> filter(fn: (r) => r[\"_field\"] == \"influxdb_ok\")\n  |> aggregateWindow(every: v.windowPeriod, fn: last, createEmpty: false)\n  |> yield(name: \"last\")"}],"staticLegend":{},"width":3,"xPos":9},{"colors":[{"id":"base","name":"viridian","type":"text","hex":"#32B08C"},{"id":"YwJHg33LkUZDF6cOhsNPN","name":"pineapple","type":"text","hex":"#FFB94A","value":500},{"id":"fAqvWS9ZxAS32rsPIlPcQ","name":"fire","type":"text","hex":"#DC4E58","value":1000}],"decimalPlaces":0,"height":2,"kind":"Single_Stat","name":"Average Ping Duration [ms]","queries":[{"query":"from(bucket: \"netscan\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"ping\")\n  |> filter(fn: (r) => r[\"_field\"] == \"rtt_ms\")\n  |> filter(fn: (r) => r._value > 0.0)\n  |> group() // <-- Add this line to ungroup all devices\n  |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)\n  |> yield(name: \"overall_average_rtt_ms\")"}],"staticLegend":{},"suffix":" ms","width":3,"xPos":9,"yPos":2}],"name":"InfluxDB Health"}}]